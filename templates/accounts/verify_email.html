{% extends 'accounts/base.html' %} {% block title %}تأیید ایمیل{% endblock %} {% block header %}کد تأیید ایمیل{% endblock %} {% block content %}
<p class="text-muted">یک کد ۶ رقمی به ایمیل شما ارسال شد. لطفاً آن را وارد کنید.</p>

{% if error %}
<div class="alert alert-danger">
    {{ error }}
</div>
{% endif %}

<form method="post" class="mt-3">
    {% csrf_token %}
    <div class="mb-3">
        <input type="text" name="code" class="form-control text-center" placeholder="کد تأیید را وارد کنید" required>
    </div>
    <button type="submit" class="btn btn-success w-100">✅ تأیید</button>
</form>

<!-- دکمه ارسال مجدد کد با تایمر -->
<p class="mt-3 text-center">
    <button id="resend-btn" class="btn btn-secondary" disabled>🔄 ارسال مجدد کد (60)</button>
</p>

<style>
    input {
        border-radius: 5px;
        text-align: center;
        font-size: 18px;
    }
    
    button {
        font-weight: bold;
        transition: 0.3s;
    }
    
    .btn-success {
        background: linear-gradient(45deg, #28a745, #218838);
    }
    
    .btn-success:hover {
        background: linear-gradient(45deg, #218838, #1e7e34);
    }
    
    .btn-secondary {
        background: #6c757d;
        border: none;
    }
    
    .btn-secondary:disabled {
        background: #b1b1b1;
        cursor: not-allowed;
    }
</style>

<!-- جاوااسکریپت برای تایمر -->
<script>
    let countdown = 60;
    let resendBtn = document.getElementById("resend-btn");

    function updateTimer() {
        resendBtn.textContent = `🔄 ارسال مجدد کد (${countdown})`;
        countdown--;
        if (countdown < 0) {
            resendBtn.textContent = "🔄 ارسال مجدد کد";
            resendBtn.removeAttribute("disabled");
        } else {
            setTimeout(updateTimer, 1000);
        }
    }

    setTimeout(updateTimer, 1000);

    resendBtn.addEventListener("click", function() {
        resendBtn.setAttribute("disabled", "true");
        countdown = 60;
        updateTimer();
        window.location.href = "{% url 'resend_verification' %}"; // ارسال درخواست مجدد
    });
</script>

{% endblock %}